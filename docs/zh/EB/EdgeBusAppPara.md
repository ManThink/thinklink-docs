# EB APP 参数
本文档旨在为研发及技术支持人员提供一份详尽的 EdgeBus 功能配置指南，核心内容围绕通过 App 参数对 EdgeBus 进行配置。EdgeBus 的参数体系结构清晰，主要划分为 **版本信息**、**运行参数** 和 **系统信息** 三大类别，便于使用者理解与操作。

###  目标读者
本文档主要面向需要与 EdgeBus 设备进行深度集成和调试的 **研发工程师** 与 **技术支持工程师**。

### 配置方式入门
参考 ThinkLink 自带RPC功能

## 版本信息 (Version Information)
版本信息参数提供了 EdgeBus 设备的固件与硬件标识，共占据 8 字节，所有数据均为 **只读**。

| 地址 | 长度  | 权限 | 字段 | 描述                                                                                                              |
| :--- | :--- | :--- | :--- |:----------------------------------------------------------------------------------------------------------------|
| 0 | 1B | 只读 | `fuotaversion` `hwtype` | **bit0-bit3**: FUOTA版本号,升级时,数据包中版本号需与此匹配。   <br>**bit4-bit7**: 产品硬件型号低 4 位 (共 12 位)。                            |
| 1 | 1B | 只读 | `hwtype` | 产品硬件型号高 8 位 (共 12 位)。                                                                                           |
| 2 | 1B | 只读 | `hwversion` | **bit0-bit3**: FUOTA 升级时拷贝的字节数 `4 * (len + 1)`。   <br>**bit4-bit7**: 硬件版本号，范围 1-15。                             |
| 3 | 1B | 只读 | `swversion` | 软件版本号，范围 1-255。                                                                                                 |
| 4-5 | 2B | 只读 | `bztype` | 对接的业务设备型号。                                                                                                      |
| 6 | 1B | 只读 | `bzversion` | 业务参数版本号。                                                                                                        |
| 7 | 1B | 只读 | `filtermask` <br/>`otamask` <br/>`checkOk` | **bit0-bit2**: `filtermask`。   <br>**bit3**: 保留。   <br>**bit4-bit6**: `otamask`。   <br>**bit7**: `checkOk` 标志位。 |


## 运行参数 (Running Parameters)
运行参数决定了 EdgeBus 运行期间的工作模式与核心功能，共占据 16 字节。

| 地址 | 长度  | 权限 | 字段 | 描述                                                                                                                                                                                                                                                                                                          |
| :--- | :--- | :--- | :--- |:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 8 | 1B | 读/写 | `fieldMode` <br/>`RelayEnable` | **bit0**: `fieldMode`。   <br>**bit1**: `RelayEnable`，置 1 开启中继功能。   <br>**bit2-bit7**: 保留。                                                                                                                                                                                                                   |
| 9 | 1B | 写 | 功能触发 | 用于触发 EdgeBus 执行特定操作：   - **写入 1**: 设备复位。   <br>- **写入 2**: 执行所有查询和上传任务。   <br>- **写入 4**: 重新入网。                                                                                                                                                                                                             |
| 10 | 1B | 读/写 | `Resv` | 保留。                                                                                                                                                                                                                                                                                                         |
| 11 | 1B | 读/写 | 唤醒与通道配置 | **bit0**: 置 1 允许通过 PC6 引脚输入低电平唤醒 EdgeBus。   <br>**bit1**: 置 1 在 UART 发送数据前通过 PC2 输出低电平以唤醒客户 MCU。   <br>**bit2-bit3**: 保留。   <br>**bit4-bit6**: 回传通道选择 (0: LoRaWAN, 1: 4G)。   <br>**bit7**: 保留。                                                                                                              |
| 12 | 1B | 读/写 | 串口波特率 | 值为 `串口波特率/12`。<br/>例如，波特率为 9600 时，此值为 800 (9600/12)。                                                                                                                                                                                                                                                        |
| 13 | 1B | 读/写 | 串口通信参数 | <br>**bit0-bit3**: 数据位。   <br>**bit4-bit5**: 停止位。   <br>**bit6-bit7**: 校验位 (0: 无校验, 1: 奇校验, 2: 偶校验)。   <br>**注意**: 不同硬件平台在偶校验下的数据位设置存在差异：   <br>- **OMx11**: 8 位数据位 + 偶校验时，数据位(bit0-bit3)应设为 9，校验位(bit6-bit7)设为 2。   <br>- **OMx22**: 8 位数据位 + 偶校验时，数据位(bit0-bit3)设为 8，校验位(bit6-bit7)设为 2。                                          |
| 14 | 1B | 读/写 | 工作模式 | <br>**bit0**: 置 1 使 EdgeBus 保持接收状态，适用于对接设备主动上传数据的场景。   <br>**bit1**: 置 1 启用低功耗模式。   <br>**bit2**: 置 1 通过 UART1 与对接设备交换数据。   <br>**bit3**: 置 1 启用透传模式。   <br>**bit4**: 通道选择 (0: LoRaWAN, 1: Lora)。   <br>**bit5**: 置 1 开启上电自动重新入网功能。   <br>**bit6**: 置 1 使EdgeBus上电后通过 Lora通道发送自身信息。   <br>**bit7**: 置 1 使 EdgeBus 在上电 60 秒内完成对时、模式切换等初始化工作。 |
| 15 | 1B | 读/写 | `confirm` 占空比 | 当上行数据包序号为此值的整数倍时，发送 `confirm` 包，否则发送 `unconfirm` 包。                                                                                                                                                                                                                                                         |
| 16 | 1B | 读/写 | 参数读写端口 | 用于读取或设置 EdgeBus 参数的端口号。                                                                                                                                                                                                                                                                                     |
| 17 | 1B | 读/写 | 透传通道端口 | 透传模式下的通信端口号。                                                                                                                                                                                                                                                                                                |
| 18-19 | 2B | 读/写 | 定时复位周期 | EdgeBus 将根据此设置的小时数定时复位。                                                                                                                                                                                                                                                                                     |
| 20-23 | 4B | 读/写 | 上行时间偏移 | 单位为毫秒 (ms)。EdgeBus 上传数据时会加上此时间偏移，通常设置为 0。                                                                                                                                                                                                                                                                   |


## 系统信息 (System Information)
系统信息参数提供了关于 EdgeBus 硬件状态和环境的实时数据。

| 地址 | 长度  | 权限 | 字段 | 描述                                                                                                                                                                                                                             |
| :--- | :--- | :--- | :--- |:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 24 | 1B | 读/写 | `batterybase` | 电池电量基准值。                                                                                                                                                                                                                       |
| 25-28 | 4B | 读/写 | UTC 时间 | 自 1970 年 1 月 1 日以来的秒数。                                                                                                                                                                                                         |
| 29-30 | 2B | 只读 | 芯片温度 | 实际温度值 (°C) = (`读取值` - 1000) / 10。                                                                                                                                                                                              |
| 31 | 1B | 只读 | 芯片供电电压 | 供电电压 (V) = (`读取值` / 254 ) * 1.6+ 2。                                                                                                                                                                                            |
| 32-33 | 2B | 读/写 | 查询超时时间 | **bit0-bit13**: 超时时间值。   <br>**bit14-bit15**: 超时单位 (0: 秒, 1: 分, 2: 时, 3: 毫秒)。                                                                                                                                                  |
| 34 | 1B | 读/写 | 超时重查次数 | 查询超时后，重新尝试查询的次数。                                                                                                                                                                                                               |
| 35 | 1B | 读/写 | 串口数据校准 | **bit0**: 置 1 开启串口数据校准。   <br>**bit1-bit2**: 校准方式 (0: 或, 1: 与, 2: 直接替换)。   <br>**bit3-bit7**: 保留。                                                                                                                              |
| 36 | 1B | 读/写 | 串口校准组数 | 定义校准规则的数量。校准规则从地址 170 开始，每 3 字节为一组，分别定义起始索引、长度和校准值。                                                                                                                                                                            |
| 37 | 1B | 读/写 | 周期性入网周期 | 设备进行周期性重新入网的时间间隔。                                                                                                                                                                                                              |
| 38-39 | 2B | 读/写 | 外设上电延时 | 单位为毫秒 (ms)。适用于低功耗产品，确保外设 (如 RS485) 在执行操作前电源稳定。                                                                                                                                                                                 |
| 40-43 | 4B | 读/写 | 心跳周期 | 单位 秒 默认 86400                                                                                                                                                                                                                  |
| 44-59 | 16B | 只读 | 系统保留 | 系统保留                                                                                                                                                                                                                           |
| 60 | 1B | 读/写 | sub_device_counts | 多设备模式下，对接设备的个数 默认 0                                                                                                                                                                                                            |
| 61-64 | 4B | 只读 | 系统保留 | 系统保留                                                                                                                                                                                                                           |
| 65 | 1B | 读/写 | query_index | 设备地址在查询命令中的起始索引                                                                                                                                                                                                                |
| 66 | 1B | 读/写 | sub_addr_size | 多设备模式下，子设备地址长度                                                                                                                                                                                                                 |
| 67- | nB | 读/写 | sub_addr | 多设备模式下，子设备地址，按照sub_addr_size 大小<br/>依次子设备地址：<br/>- **设备 1**: 67 ~ `67 + sub_addr_size - 1`   <br>- **设备 2**: `67 + Len` ~ `67 + 2*sub_addr_size - 1`   <br>- **设备 N**: `67 + (N-1)*sub_addr_size` ~ `67 + N*sub_addr_size - 1` |


## 其他参数 (Other Parameters)
### 用户开放地址空间
+ **地址范围**: `70` - `200`
+ **描述**: 此段地址空间保留给用户自由使用，可用于存储自定义数据。

### 建议地址使用方法
`70`-`109` ： 按4字节单位为秒保存周期（查询周期或者上行周期）

`110`-`149`：为COV的阈值存储区

`150`-`200`：为子设备地址或其他数据存储区

🌐 官网：[www.manthink.cn](http://www.manthink.cn)  
✉ 技术支持邮箱：info@manthink.cn  
☎ 紧急联系电话：+86-15810684257

